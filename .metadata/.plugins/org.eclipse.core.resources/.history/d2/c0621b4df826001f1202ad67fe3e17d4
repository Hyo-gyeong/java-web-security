package pw_manager;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.security.SecureRandom;

import enums.FilePath;

public class Salt {
	private static byte[] getSalt() throws IOException {
		String saltPath = FilePath.SALT.getPath();
		File saltFile = new File(saltPath);
		
		// salt 파일이 없으면
		if (!saltFile.exists()) {
            try {
            	// 파일 생성하고
            	saltFile.createNewFile();
            	// pw + salt 후 파일에 저장
            	saltGenerator();
            } catch (IOException e) {
            	throw new IOException();
            }
        }
		// pw + salt 해시값 리턴
		return readFromFile(saltPath);
	}
	
	private static void saltGenerator() throws IOException {
		//1. Random, byte 객체 생성
		SecureRandom  r = new SecureRandom ();
		byte[] salt = new byte[20];
		
		//2. 난수 생성
		r.nextBytes(salt);
		
		saveHashToFile(salt, FilePath.SALT.getPath());
	}
	
	private static void saveHashToFile(byte[] hashValue, String filePath) throws IOException {
		try (FileOutputStream out = new FileOutputStream(filePath)) {
            out.write(hashValue);
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }	
	}
}
